# 要件定義書

## プロジェクト情報

**プロジェクト名**: e-gov API FastAPI
**バージョン**: 1.0.0
**作成日**: 2025-11-14
**対象期間**: Phase 1-4（約6-12ヶ月）

## 1. プロジェクト概要

### 1.1 目的
日本国内の法律および判例に関する正確で最新の情報を取得・提供するAPIシステムを構築する。将来的にAI（Claude Agent SDK）との統合により、自然言語での法律相談や文書分析機能を実現する。

### 1.2 背景
- 法律情報へのアクセスが専門家以外には困難
- 既存の法令データベースは検索性や利便性に課題
- AI技術を活用した法律サービスの需要増加
- e-govや裁判所の公開データを効率的に活用できていない

### 1.3 ステークホルダー
- **開発チーム**: システム開発・運用
- **法務関係者**: 法律専門家、弁護士、司法書士
- **一般利用者**: 法律情報を必要とする個人・企業
- **AI統合利用者**: Claude Agent SDKを使用するアプリケーション開発者

## 2. システム要件

### 2.1 機能要件

#### 2.1.1 法令情報管理（Phase 1）
- **FR-001**: e-gov法令APIとの連携
  - 法令データの検索機能
  - 法令の全文取得機能
  - 法令番号・名称による検索
  - キーワード検索（全文検索）

- **FR-002**: 法令改正履歴管理
  - 改正履歴の取得
  - 改正前後の条文比較
  - 施行日情報の提供

- **FR-003**: 法令データキャッシング
  - 頻繁にアクセスされる法令データのキャッシュ
  - キャッシュの自動更新メカニズム

#### 2.1.2 判例情報管理（Phase 2）
- **FR-004**: 判例データ取得
  - 裁判所ウェブサイトからのデータ取得
  - 判例番号・事件名による検索
  - 裁判年月日・裁判所による絞り込み

- **FR-005**: 判例データ構造化
  - 判例テキストの構造化（判決要旨、理由など）
  - メタデータの抽出（裁判所、事件番号、日付等）

- **FR-006**: 判例データベース構築
  - 取得した判例データの永続化
  - 全文検索インデックスの構築

#### 2.1.3 RESTful API提供（Phase 1-2）
- **FR-007**: 法令検索API
  - `GET /api/v1/laws/search`
  - クエリパラメータ: q（検索語）, type（法令種別）, limit, offset
  - レスポンス: 検索結果リスト（法令名、番号、URL）

- **FR-008**: 法令詳細取得API
  - `GET /api/v1/laws/{law_id}`
  - レスポンス: 法令全文、メタデータ

- **FR-009**: 法令改正履歴API
  - `GET /api/v1/laws/{law_id}/history`
  - レスポンス: 改正履歴リスト

- **FR-010**: 判例検索API
  - `GET /api/v1/cases/search`
  - クエリパラメータ: q, court, date_from, date_to, limit, offset
  - レスポンス: 判例検索結果リスト

- **FR-011**: 判例詳細取得API
  - `GET /api/v1/cases/{case_id}`
  - レスポンス: 判例全文、メタデータ

#### 2.1.4 AI統合機能（Phase 3）
- **FR-012**: Agentic RAG実装
  - 法令・判例を横断した意味的検索
  - コンテキストを考慮した情報取得
  - 関連法令・判例の自動推薦

- **FR-013**: Claude Agent SDK統合
  - MCPサーバーとしての機能提供
  - カスタムツール: `search_law`, `search_case`
  - ツール実行結果のフォーマット

- **FR-014**: MCP Tool定義
  - `search_law`: 法令検索ツール
  - `search_case`: 判例検索ツール
  - `get_law_detail`: 法令詳細取得ツール
  - `get_case_detail`: 判例詳細取得ツール
  - `compare_laws`: 法令比較ツール

#### 2.1.5 高度な分析機能（Phase 4）
- **FR-015**: 法令・判例関連性分析
  - 引用関係の可視化
  - 関連判例の自動抽出

- **FR-016**: 自然言語法律相談
  - 質問文から関連法令・判例を抽出
  - 回答生成（Claude経由）

- **FR-017**: 法的文書自動要約
  - 長文判例の要約生成
  - 法令条文の平易な言葉への変換

### 2.2 非機能要件

#### 2.2.1 性能要件
- **NFR-001**: レスポンスタイム
  - 検索API: 平均500ms以内、最大2秒
  - 詳細取得API: 平均300ms以内、最大1秒
  - キャッシュヒット時: 100ms以内

- **NFR-002**: スループット
  - 同時リクエスト処理: 最低100req/sec
  - ピーク時対応: 500req/sec

- **NFR-003**: 可用性
  - システム稼働率: 99.5%以上
  - 計画メンテナンス: 月1回、深夜時間帯

#### 2.2.2 セキュリティ要件
- **NFR-004**: 認証・認可
  - API Key認証の実装
  - レート制限（Rate Limiting）
  - IPベースのアクセス制限（オプション）

- **NFR-005**: データ保護
  - HTTPS通信の強制
  - 個人情報の非保存（検索ログは匿名化）

- **NFR-006**: セキュリティヘッダー
  - CORS設定
  - セキュリティヘッダーの適切な設定

#### 2.2.3 拡張性要件
- **NFR-007**: スケーラビリティ
  - 水平スケーリング対応
  - ステートレスなAPI設計

- **NFR-008**: データベース
  - PostgreSQL使用（判例データ永続化）
  - Redis使用（キャッシング）

#### 2.2.4 保守性要件
- **NFR-009**: ログ管理
  - アクセスログの記録
  - エラーログの詳細記録
  - ログローテーション

- **NFR-010**: モニタリング
  - API利用状況のモニタリング
  - エラー率の監視
  - レスポンスタイムの監視

- **NFR-011**: ドキュメント
  - OpenAPI (Swagger) 自動生成
  - README、CLAUDE.mdの維持
  - API仕様書の自動生成

#### 2.2.5 互換性要件
- **NFR-012**: Python要件
  - Python 3.10以上
  - 主要なOSでの動作（Linux, macOS, Windows）

- **NFR-013**: ブラウザ対応
  - Swagger UI対応（モダンブラウザ）

## 3. 技術要件

### 3.1 開発環境
- **言語**: Python 3.10+
- **フレームワーク**: FastAPI
- **パッケージマネージャー**: uv
- **データベース**: PostgreSQL 14+, Redis 6+
- **AI統合**: Claude Agent SDK (Python)

### 3.2 外部サービス依存
- **e-gov法令API**: https://elaws.e-gov.go.jp/
- **裁判所ウェブサイト**: https://www.courts.go.jp/
- **Anthropic API**: Claude API（AI機能用）

### 3.3 開発ツール
- **バージョン管理**: Git
- **CI/CD**: GitHub Actions（予定）
- **テスト**: pytest, pytest-asyncio
- **リンター**: ruff, mypy
- **フォーマッター**: black

## 4. 制約事項

### 4.1 技術的制約
- e-gov APIの利用制限に準拠
- 裁判所ウェブサイトのスクレイピング規約遵守
- Claude APIのレート制限・コスト考慮

### 4.2 法的制約
- 著作権法遵守（判例データの取り扱い）
- 利用規約の明示
- データソースの適切なクレジット表記

### 4.3 リソース制約
- 初期開発期間: 6-12ヶ月
- 開発チーム規模を考慮した段階的開発

## 5. 成果物

### 5.1 Phase 1
- FastAPIアプリケーション（基本構造）
- e-gov APIクライアント
- 法令検索・取得API
- 単体テスト・統合テスト
- API仕様書（Swagger）

### 5.2 Phase 2
- 判例データ取得モジュール
- 判例検索・取得API
- データベーススキーマ
- データ取得スクリプト

### 5.3 Phase 3
- RAGシステム実装
- Claude Agent SDK統合
- MCPサーバー実装
- カスタムツール定義

### 5.4 Phase 4
- 高度な分析機能
- 自然言語インターフェース
- 文書要約機能
- 運用マニュアル

## 6. リスク管理

### 6.1 技術リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| e-gov API仕様変更 | 高 | API変更の監視、アダプターパターン採用 |
| スクレイピング制限 | 中 | 代替データソース確保、APIの優先利用 |
| Claude API コスト増 | 中 | キャッシング、リクエスト最適化 |

### 6.2 運用リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| データ更新遅延 | 中 | 定期更新バッチ、手動更新手段の確保 |
| 大量アクセス | 中 | レート制限、キャッシング強化 |

## 7. スケジュール（目安）

- **Phase 1**: 2-3ヶ月（基盤構築）
- **Phase 2**: 2-3ヶ月（判例データ統合）
- **Phase 3**: 2-3ヶ月（AI統合）
- **Phase 4**: 2-3ヶ月（高度な機能）

## 8. 承認

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| プロジェクトマネージャー | | | |
| 技術リーダー | | | |
| 品質管理責任者 | | | |

---

**改訂履歴**

| バージョン | 日付 | 作成者 | 変更内容 |
|-----------|------|--------|----------|
| 1.0.0 | 2025-11-14 | | 初版作成 |
